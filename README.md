# PrivyPlay

PrivyPlay is a privacy-first on-chain dice game built on Zama FHEVM. Players swap ETH for encrypted points, pay to roll, submit encrypted guesses, and settle outcomes with on-chain randomness.

## Overview
PrivyPlay keeps player intent and balances confidential while preserving verifiable game fairness. The game logic runs on-chain, using Zama Fully Homomorphic Encryption (FHE) to keep points and guesses encrypted end-to-end.

## Problem It Solves
Traditional on-chain games expose player behavior and balances, enabling copy-trading, front-running, and unfair targeting. PrivyPlay removes those data leaks by encrypting sensitive state while keeping game logic verifiable.

## Gameplay Flow
1. Join the game by exchanging ETH for points. Rate: 1 ETH = 1,000,000 encrypted points.
2. Start a round by spending 100 points. The system rolls a dice using on-chain Zama randomness (1 to 6).
3. Submit a guess: big is true, small is false. The guess is encrypted on-chain.
4. The contract compares your encrypted guess with the dice size. Correct guesses earn 1,000 points; incorrect guesses earn 0.

## Key Advantages
- Private gameplay: guesses and balances are encrypted with FHE.
- Verifiable fairness: randomness and settlement are on-chain.
- Minimal trust: no centralized server decides outcomes.
- Composable: works with standard wallet flows and Sepolia testnet.
- Clear economics: fixed exchange rate and predictable rewards.

## Tech Stack
- Smart contracts: Solidity + Hardhat
- FHE: Zama FHEVM
- Frontend: React + Vite
- Web3 stack: RainbowKit, wagmi, viem (read), ethers (write)
- Relayer: Zama relayer SDK

## Architecture
- contracts/ contains the encrypted dice game logic.
- deploy/ holds deployment scripts for local and Sepolia environments.
- tasks/ provides helper tasks for local operations.
- test/ verifies correctness of game rules and encryption flows.
- app/ hosts the React frontend.

## Repository Layout
- contracts/ PrivyPlay smart contract
- deploy/ deployment scripts
- tasks/ Hardhat tasks
- test/ automated tests
- app/ React frontend
- docs/ Zama references used for implementation

## Requirements
- Node.js 20+ and npm
- A funded wallet for Sepolia

## Environment Configuration
Create a root .env file for Hardhat with:

PRIVATE_KEY=your_private_key
INFURA_API_KEY=your_infura_api_key
ETHERSCAN_API_KEY=optional_etherscan_key

Notes:
- Deployment uses a private key only. Do not use a mnemonic.
- The frontend does not rely on environment variables.

## Install

npm install

## Compile and Test

npm run compile
npm run test

## Local Development

# Start a local FHEVM-ready node
npx hardhat node

# Deploy to the local node
npx hardhat deploy --network localhost

## Sepolia Deployment

# Deploy to Sepolia
npx hardhat deploy --network sepolia

# Optional verification
npx hardhat verify --network sepolia <CONTRACT_ADDRESS>

## Frontend Development

cd app
npm install
npm run dev

Use a wallet connected to Sepolia. The frontend reads the ABI generated by the contracts from deployments/sepolia and uses it for on-chain calls.

## How Privacy Works
- Points and guesses are stored as encrypted values.
- The relayer and FHEVM handle encryption, decryption, and re-encryption without revealing plaintext to the chain.
- The contract evaluates game rules on encrypted data, keeping results private until exposed by explicit user actions.

## Testing Strategy
- Unit tests validate exchange rates, costs, and reward logic.
- FHE-specific tests ensure encrypted comparisons match expected outcomes.
- Task scripts validate deploy-time configuration and permissions.

## Limitations
- FHE operations add computational overhead compared to plaintext contracts.
- Requires the Zama relayer for encrypted user inputs.
- Currently focused on a single dice game mode.

## Future Roadmap
- Add multi-round sessions with escalating rewards.
- Expand to additional encrypted mini-games.
- Add richer analytics that preserve privacy.
- Improve UX around encrypted approvals and relayer availability.
- Integrate further randomness sources for resilience.

## License
BSD-3-Clause-Clear. See LICENSE.
